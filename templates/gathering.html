{% extends "base.html" %}

{% block title %}Create Gathering{% end %}

{% block body %}

<div class="starter-template">
	<h1>Eat / Wtf / Sg</h1>
	<div id="map-canvas" style="height:500px"></div>
	<input class='btn btn-default btn-lg' type="submit" value="Update Location" id="update-btn"/>
</div>

<script>
var map;

function renderGathering(gathering) {
	var friends = gathering.friends;
	var recommendations = gathering.recommendations;
	var selected_rec = gathering.selected_rec;

	var mapOptions = {
		zoom: 100,
	};
	var bounds = new google.maps.LatLngBounds();
	if (!map) {
		map = new google.maps.Map(document.getElementById('map-canvas'),mapOptions);
	}
	
	for (var k in friends) {
		var marker = new google.maps.Marker({
			position: new google.maps.LatLng(friends[k][0],friends[k][1]),
			map: map
		});
		bounds.extend(marker.position);
	}
	var infowindow = new google.maps.InfoWindow({
		map: map,
		position: new google.maps.LatLng(gathering.centroid[0],gathering.centroid[1]),
		content: 'CENTRE'
	});
	map.fitBounds(bounds)
	console.log(document.getElementById('map-canvas'))
}

function handleNoGeolocation(errorFlag) {
}

function updateLocation() {
	if(navigator.geolocation) {
		navigator.geolocation.getCurrentPosition(function(position) {
			$.post(window.location.pathname, {
				lat: position.coords.latitude,
				lng: position.coords.longitude
			},function(gathering) {
				renderGathering(gathering);
			});
		}, function() {
			handleNoGeolocation(true);
		});
	}
	else {
		handleNoGeolocation(false);
	}
}

$('#update-btn').click(updateLocation);

updateLocation();

</script>

{% end %}
