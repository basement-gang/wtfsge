{% extends "base.html" %}

{% block title %}Create Gathering{% end %}

{% block body %}

<div class="starter-template">
	<h1>Eat / Wtf / Sg</h1>
	<div id="map-canvas" style="height:500px"></div>
</div>
<script>

var map;

function renderGathering(gathering) {
	console.log(gathering);
	var friends = gathering.friends;
	var recommendations = gathering.recommendations;
	var selected_rec = gathering.selected_rec;

	var mapOptions = {
		zoom: 100,
	};
	var bounds = new google.maps.LatLngBounds();
	map = new google.maps.Map(document.getElementById('map-canvas'),
		mapOptions);
	
	for (var k in friends) {
		var marker = new google.maps.Marker({
			position: new google.maps.LatLng(friends[k][0],friends[k][1]),
			map: map
		});

		bounds.extend(marker.position);
	}

	map.fitBounds(bounds)
	console.log(document.getElementById('map-canvas'))
}

function handleNoGeolocation(errorFlag) {
	if (errorFlag) {
		var content = 'Error: The Geolocation service failed.';
	} else {
		var content = 'Error: Your browser doesn\'t support geolocation.';
	}

	var options = {
		map: map,
		position: new google.maps.LatLng(60, 105),
		content: content
	};

	var infowindow = new google.maps.InfoWindow(options);
	map.setCenter(options.position);
}

if(navigator.geolocation) {
	navigator.geolocation.getCurrentPosition(function(position) {
		$.post(window.location.pathname, {
			lat: position.coords.latitude,
			lng: position.coords.longitude
		},function(gathering) {
			renderGathering(gathering);
		});
	}, function() {
		handleNoGeolocation(true);
	});
} else {
	handleNoGeolocation(false);
}


</script>

{% end %}
